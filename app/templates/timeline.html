{% extends "base.html" %}

{% block title %}Timeline - Price Spy{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-12">
    <!-- Header Area -->
    <div class="mb-16 text-center">
        <h1 class="text-5xl font-black text-jolly-dark tracking-tighter mb-4">
            PURCHASE <span class="text-jolly underline decoration-jolly-lime/30">TIMELINE</span>
        </h1>
        <p class="text-jolly-dark/60 font-medium uppercase tracking-widest text-xs">Visualize your wishlist and plan your spies</p>
    </div>

    {% if timeline %}
        <div class="relative">
            <!-- Central Line -->
            <div class="absolute left-4 sm:left-1/2 top-0 bottom-0 w-1 bg-gradient-to-b from-jolly via-jolly-lime to-transparent rounded-full -translate-x-1/2 opacity-20"></div>

            {% for year_data in timeline %}
                <!-- Year Header -->
                <div class="relative z-10 flex justify-start sm:justify-center mb-12">
                    <div class="bg-jolly-dark text-white px-6 py-2 rounded-2xl font-black text-2xl shadow-xl shadow-jolly-dark/20 border-4 border-white">
                        {{ year_data.year }}
                    </div>
                </div>

                {% for week_data in year_data.weeks %}
                    <div class="relative mb-16">
                        <!-- Week Marker -->
                        <div class="absolute left-4 sm:left-1/2 -translate-x-1/2 flex items-center justify-center z-20">
                            <div class="w-10 h-10 bg-white border-4 border-jolly rounded-full flex items-center justify-center shadow-lg">
                                <span class="text-[10px] font-black text-jolly italic">W{{ week_data.week }}</span>
                            </div>
                        </div>

                        <!-- Products for this Week -->
                        <div class="space-y-6 pt-12">
                            {% for product in week_data.products %}
                                <div class="relative flex flex-col sm:flex-row items-start sm:items-center gap-8 {{ 'sm:flex-row-reverse' if loop.index is even else '' }}">
                                    <!-- Spacer for opposite side -->
                                    <div class="hidden sm:block w-1/2 px-8"></div>
                                    
                                    <!-- Product Card -->
                                    <div class="w-full sm:w-1/2 px-4 sm:px-8">
                                        <div class="bg-white p-6 rounded-[2.5rem] border border-jolly-dark/5 shadow-sm hover:shadow-xl hover:shadow-jolly/5 transition-all group relative overflow-hidden">
                                            <!-- Category Badge -->
                                            <span class="inline-block px-3 py-1 rounded-full bg-jolly/10 text-jolly-dark text-[9px] font-black uppercase tracking-widest mb-3">
                                                {{ product.category }}
                                            </span>

                                            <h3 class="text-xl font-black text-jolly-dark mb-4 leading-tight group-hover:text-jolly transition-colors">
                                                {{ product.name }}
                                            </h3>

                                            <div class="flex items-end justify-between gap-4">
                                                <div>
                                                    <p class="text-[9px] font-black text-jolly-dark/40 uppercase tracking-widest mb-1">Target</p>
                                                    <p class="font-bold text-jolly-dark">
                                                        {% if product.target_price %}
                                                            {{ product.target_price }} {{ product.currency }}
                                                            {% if product.target_unit %}
                                                                <span class="text-xs text-gray-400 font-medium">/ {{ product.target_unit }}</span>
                                                            {% endif %}
                                                        {% else %}
                                                            <span class="text-gray-300">N/A</span>
                                                        {% endif %}
                                                    </p>
                                                </div>

                                                <div class="text-right">
                                                    <p class="text-[9px] font-black text-jolly-dark/40 uppercase tracking-widest mb-1">Current Best</p>
                                                    {% if product.best_price %}
                                                        <div class="flex flex-col items-end">
                                                            {% if product.best_unit_price %}
                                                                <p class="text-xl font-black text-jolly-lime tracking-tighter">
                                                                    {{ product.best_unit_price }} {{ product.currency }} <span class="text-sm font-bold text-jolly-lime/70">/ {{ product.best_unit }}</span>
                                                                </p>
                                                                <p class="text-[10px] mobile-price-sub font-medium text-gray-400">
                                                                    ({{ product.best_price }} {{ product.currency }} total)
                                                                </p>
                                                            {% else %}
                                                                <p class="text-xl font-black text-jolly-lime tracking-tighter">
                                                                    {{ product.best_price }} {{ product.currency }}
                                                                </p>
                                                            {% endif %}
                                                        </div>
                                                    {% else %}
                                                        <a href="/products" class="text-[10px] font-black text-jolly hover:underline uppercase tracking-tighter">
                                                            Start Spying üîç
                                                        </a>
                                                    {% endif %}
                                                </div>
                                            </div>

                                            <!-- Decorative dots -->
                                            <div class="absolute -right-4 -bottom-4 w-12 h-12 bg-jolly/5 rounded-full"></div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            {% endfor %}
        </div>
    {% else %}
        <!-- Empty State -->
        <div class="text-center py-24 bg-gray-50 rounded-[4rem] border-4 border-dashed border-gray-100">
            <div class="text-6xl mb-6">üèúÔ∏è</div>
            <h2 class="text-2xl font-black text-jolly-dark mb-2 uppercase italic">The Horizon is Empty</h2>
            <p class="text-jolly-dark/40 font-medium mb-8">You haven't planned any purchases yet.</p>
            <a href="/products" class="inline-flex items-center gap-2 bg-jolly text-white px-8 py-4 rounded-3xl font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-xl shadow-jolly/20">
                Plan a Purchase
            </a>
        </div>
    {% endif %}

    <!-- Footer Decoration -->
    <div class="mt-24 text-center">
        <div class="inline-block w-2 h-2 rounded-full bg-jolly mx-1"></div>
        <div class="inline-block w-2 h-2 rounded-full bg-jolly mx-1 opacity-50"></div>
        <div class="inline-block w-2 h-2 rounded-full bg-jolly mx-1 opacity-20"></div>
    </div>
</div>

<style>
    /* Custom bounce for the spine dots */
    @keyframes linePop {
        0% { opacity: 0; transform: scale(0.5); }
        100% { opacity: 1; transform: scale(1); }
    }
</style>
{% endblock %}
