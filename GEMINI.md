# Development Rules

- **Workflow:** Always use Test-Driven Development (TDD). Write the test first, verify failure, then implement.
- **Documentation:** Only update documentation (READMEs, logs, etc.) at the **end** of a completed task. Do not update docs for every incremental step.
- **Conciseness:** Be extremely brief. Skip conversational fillers and summaries of completed tool calls.
- **Permissions:** Do not ask for confirmation for read-only commands (ls, cat, grep, find).
- **Task Execution:** If a task has multiple logical steps, execute them sequentially without stopping to report progress unless an error occurs.
- **Database changes:** Do not make changes to the database schema without first having a migration strategy and checking how can it affect the current stored data.
- **Database Safety:** All tests must use a disposable temporary database. Connecting to `data/pricespy.db` during tests is strictly blocked by a safety guard in the `Database` class.
- **Database Versioning:** Use `python3 scripts/db_manager.py dump` to version the current data state in Git via `data/pricespy_dump.sql`. Binary `.db` files must NEVER be committed.
- **Database Migrations:** Place new `.sql` migrations in `migrations/`. Run them using `python3 scripts/db_manager.py migrate`. Applied migrations are tracked in the `_migrations` table.
- **DeepSource Configuration:** Do NOT add `skip_issues` or `ignore_issues` to `.deepsource.toml`. These must be managed via the DeepSource Dashboard UI.
- **Linting & Quality:** 
    - **Ruff** is the primary linter and formatter.
    - **Pylint** is maintained for `pylint-parity` checks in `app/`.
    - **Docstrings** are explicitly disabled across all linters (`D` rules in Ruff, `missing-docstring` in Pylint).
- **Useful Commands:**
    - `pre-commit run --all-files`: Run all quality checks.
    - `ruff check .` / `ruff format .`: Lint and format code.
    - `mypy .`: Static type checking.
    - `bandit -r app/ --skip B101`: Security scan.
    - `pip-audit`: Dependency audit.
    - `pytest`: Run tests (`--cov=app` for coverage).
    - `python3 scripts/db_manager.py cleanup`: Remove old DB backups.
    - `python3 scripts/db_manager.py migrate`: Run pending migrations.
